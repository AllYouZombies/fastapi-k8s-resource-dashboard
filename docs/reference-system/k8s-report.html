<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤ Kubernetes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9em;
            color: #666;
        }

        .critical { color: #e74c3c; }
        .warning { color: #f39c12; }
        .success { color: #27ae60; }
        .info { color: #3498db; }

        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: #3498db;
            color: white;
        }

        .search-box {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
            width: 200px;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            border-bottom: 2px solid #3498db;
        }

        th:hover {
            background: #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .overuse { background-color: #ffebee !important; }
        .underuse { background-color: #e8f5e8 !important; }

        .eff-critical { color: #e74c3c; font-weight: bold; }
        .eff-warning { color: #f39c12; font-weight: bold; }
        .eff-good { color: #27ae60; font-weight: bold; }
        .eff-normal { color: #333; }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }

        .pagination button:hover {
            background: #f5f5f5;
        }

        .pagination button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .table-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab.active {
            border-bottom-color: #3498db;
            color: #3498db;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }

            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ—Å—É—Ä—Å–æ–≤ Kubernetes</h1>
            <p>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ requests –∏ limits</p>
            <p><small id="date-info">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</small></p>
        </div>

        <div id="loading" class="loading">
            <h3>‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...</h3>
        </div>

        <div id="content" style="display: none;">
            <!-- –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="section">
                <h2>üìà –°–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <div class="summary-grid" id="summary-grid">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏–∑ JSON -->
                </div>
            </div>

            <!-- –¢–∞–±—ã –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ -->
            <div class="section">
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('requests')">üéØ –ê–Ω–∞–ª–∏–∑ –ø–æ Requests</div>
                    <div class="tab" onclick="switchTab('limits')">üîí –ê–Ω–∞–ª–∏–∑ –ø–æ Limits</div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ Requests -->
                <div id="requests-tab" class="tab-content active">
                    <div class="table-controls">
                        <div class="filter-group">
                            <button class="filter-btn active" onclick="filterRequestsTable('all')">–í—Å–µ</button>
                            <button class="filter-btn" onclick="filterRequestsTable('overuse')">–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</button>
                            <button class="filter-btn" onclick="filterRequestsTable('underuse')">–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</button>
                            <button class="filter-btn" onclick="filterRequestsTable('normal')">–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ</button>
                        </div>
                        <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–æ namespace/pod/container..."
                               onkeyup="searchRequestsTable(this.value)">
                    </div>

                    <div class="table-container">
                        <table id="requests-table">
                            <thead>
                                <tr>
                                    <th onclick="sortRequestsTable(0)">Namespace ‚Üï</th>
                                    <th onclick="sortRequestsTable(1)">Pod ‚Üï</th>
                                    <th onclick="sortRequestsTable(2)">Container ‚Üï</th>
                                    <th onclick="sortRequestsTable(3)">CPU REQ ‚Üï</th>
                                    <th onclick="sortRequestsTable(4)">CPU USE ‚Üï</th>
                                    <th onclick="sortRequestsTable(5)">CPU EFF% ‚Üï</th>
                                    <th onclick="sortRequestsTable(6)">MEM REQ ‚Üï</th>
                                    <th onclick="sortRequestsTable(7)">MEM USE ‚Üï</th>
                                    <th onclick="sortRequestsTable(8)">MEM EFF% ‚Üï</th>
                                    <th onclick="sortRequestsTable(9)">–°—Ç–∞—Ç—É—Å ‚Üï</th>
                                </tr>
                            </thead>
                            <tbody id="requests-tbody">
                                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏–∑ JSON -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination" id="requests-pagination">
                        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ -->
                    </div>

                    <div class="table-info">
                        <span id="requests-info">–ü–æ–∫–∞–∑–∞–Ω–æ 0 –∏–∑ 0 –∑–∞–ø–∏—Å–µ–π</span>
                        <span>10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É</span>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ Limits -->
                <div id="limits-tab" class="tab-content">
                    <div class="table-controls">
                        <div class="filter-group">
                            <button class="filter-btn active" onclick="filterLimitsTable('all')">–í—Å–µ</button>
                            <button class="filter-btn" onclick="filterLimitsTable('overuse')">–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</button>
                            <button class="filter-btn" onclick="filterLimitsTable('underuse')">–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</button>
                            <button class="filter-btn" onclick="filterLimitsTable('normal')">–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ</button>
                        </div>
                        <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–æ namespace/pod/container..."
                               onkeyup="searchLimitsTable(this.value)">
                    </div>

                    <div class="table-container">
                        <table id="limits-table">
                            <thead>
                                <tr>
                                    <th onclick="sortLimitsTable(0)">Namespace ‚Üï</th>
                                    <th onclick="sortLimitsTable(1)">Pod ‚Üï</th>
                                    <th onclick="sortLimitsTable(2)">Container ‚Üï</th>
                                    <th onclick="sortLimitsTable(3)">CPU LIM ‚Üï</th>
                                    <th onclick="sortLimitsTable(4)">CPU USE ‚Üï</th>
                                    <th onclick="sortLimitsTable(5)">CPU EFF% ‚Üï</th>
                                    <th onclick="sortLimitsTable(6)">MEM LIM ‚Üï</th>
                                    <th onclick="sortLimitsTable(7)">MEM USE ‚Üï</th>
                                    <th onclick="sortLimitsTable(8)">MEM EFF% ‚Üï</th>
                                    <th onclick="sortLimitsTable(9)">–°—Ç–∞—Ç—É—Å ‚Üï</th>
                                </tr>
                            </thead>
                            <tbody id="limits-tbody">
                                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏–∑ JSON -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination" id="limits-pagination">
                        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ -->
                    </div>

                    <div class="table-info">
                        <span id="limits-info">–ü–æ–∫–∞–∑–∞–Ω–æ 0 –∏–∑ 0 –∑–∞–ø–∏—Å–µ–π</span>
                        <span>10 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allData = [];
        let requestsData = [];
        let limitsData = [];
        let filteredRequestsData = [];
        let filteredLimitsData = [];
        let currentRequestsPage = 1;
        let currentLimitsPage = 1;
        const itemsPerPage = 10;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON
        fetch('k8s-resources-data.json')
            .then(response => response.json())
            .then(data => {
                allData = data.containers;
                requestsData = [...allData];
                limitsData = [...allData];
                filteredRequestsData = [...allData];
                filteredLimitsData = [...allData];

                displaySummary(data.metadata);
                displayRequestsTable();
                displayLimitsTable();
                updateDate(data.metadata.generated_at);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                document.getElementById('loading').innerHTML =
                    '<h3>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3><p>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª k8s-resources-data.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∑–∞–ø—É—â–µ–Ω –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.</p>';
            });

        function updateDate(dateStr) {
            const date = new Date(dateStr);
            document.getElementById('date-info').textContent =
                `–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: ${date.toLocaleDateString('ru-RU')} ${date.toLocaleTimeString('ru-RU')}`;
        }

        function displaySummary(metadata) {
            const summary = metadata.analysis_summary;
            const cluster = metadata.cluster_info;

            document.getElementById('summary-grid').innerHTML = `
                <div class="summary-card">
                    <div class="summary-number info">${cluster.total_containers}</div>
                    <div class="summary-label">–í—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number info">${cluster.total_pods}</div>
                    <div class="summary-label">–í—Å–µ–≥–æ –ø–æ–¥–æ–≤</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number critical">${summary.requests.overuse_cpu}</div>
                    <div class="summary-label">–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU requests</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number critical">${summary.requests.overuse_memory}</div>
                    <div class="summary-label">–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Memory requests</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number warning">${summary.requests.underuse_cpu}</div>
                    <div class="summary-label">–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU requests</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number warning">${summary.requests.underuse_memory}</div>
                    <div class="summary-label">–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Memory requests</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number success">${summary.requests.potential_cpu_savings_cores}</div>
                    <div class="summary-label">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è CPU (—è–¥—Ä–∞)</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number success">${summary.requests.potential_memory_savings_gi}</div>
                    <div class="summary-label">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è Memory (Gi)</div>
                </div>
            `;
        }

        function switchTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function displayRequestsTable() {
            const tbody = document.getElementById('requests-tbody');
            const startIndex = (currentRequestsPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredRequestsData.slice(startIndex, endIndex);

            tbody.innerHTML = '';

            pageData.forEach(container => {
                const row = document.createElement('tr');

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –∫–ª–∞—Å—Å —Å—Ç—Ä–æ–∫–∏
                const cpuCategory = container.analysis.requests.cpu_category;
                const memCategory = container.analysis.requests.memory_category;
                let status = '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ';
                let rowClass = '';

                if (cpuCategory === 'overuse' || memCategory === 'overuse') {
                    status = '–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ';
                    rowClass = 'overuse';
                } else if (cpuCategory === 'underuse' || memCategory === 'underuse') {
                    status = '–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ';
                    rowClass = 'underuse';
                }

                row.className = rowClass;

                const formatEfficiency = (eff, type = 'cpu') => {
                    if (eff === 0 || eff === '-') return '<span class="eff-normal">-</span>';
                    if (type === 'cpu') {
                        if (eff > 100) return `<span class="eff-critical">${eff}%</span>`;
                        if (eff < 20) return `<span class="eff-warning">${eff}%</span>`;
                        if (eff < 80) return `<span class="eff-good">${eff}%</span>`;
                        return `<span class="eff-normal">${eff}%</span>`;
                    } else { // memory
                        if (eff > 100) return `<span class="eff-critical">${eff}%</span>`;
                        if (eff < 50) return `<span class="eff-warning">${eff}%</span>`;
                        if (eff < 90) return `<span class="eff-good">${eff}%</span>`;
                        return `<span class="eff-normal">${eff}%</span>`;
                    }
                };

                row.innerHTML = `
                    <td>${container.namespace}</td>
                    <td>${container.pod}</td>
                    <td>${container.container}</td>
                    <td>${container.resources.cpu.request}</td>
                    <td>${container.resources.cpu.usage}</td>
                    <td>${formatEfficiency(container.resources.cpu.request_efficiency_percent, 'cpu')}</td>
                    <td>${container.resources.memory.request}</td>
                    <td>${container.resources.memory.usage}</td>
                    <td>${formatEfficiency(container.resources.memory.request_efficiency_percent, 'memory')}</td>
                    <td>${status}</td>
                `;

                row.style.cursor = 'pointer';
                row.title = '–ö–ª–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥ kubectl';
                row.onclick = () => showContainerDetails(container);

                tbody.appendChild(row);
            });

            updateRequestsPagination();
            updateRequestsInfo();
        }

        function displayLimitsTable() {
            const tbody = document.getElementById('limits-tbody');
            const startIndex = (currentLimitsPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredLimitsData.slice(startIndex, endIndex);

            tbody.innerHTML = '';

            pageData.forEach(container => {
                const row = document.createElement('tr');

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –∫–ª–∞—Å—Å —Å—Ç—Ä–æ–∫–∏ –¥–ª—è limits
                const cpuCategory = container.analysis.limits.cpu_category;
                const memCategory = container.analysis.limits.memory_category;
                let status = '–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ';
                let rowClass = '';

                if (cpuCategory === 'overuse' || memCategory === 'overuse') {
                    status = '–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ';
                    rowClass = 'overuse';
                } else if (cpuCategory === 'underuse' || memCategory === 'underuse') {
                    status = '–ù–µ–¥–æ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ';
                    rowClass = 'underuse';
                }

                row.className = rowClass;

                const formatEfficiency = (eff, type = 'cpu') => {
                    if (eff === 0 || eff === '-') return '<span class="eff-normal">-</span>';
                    if (type === 'cpu') {
                        if (eff > 80) return `<span class="eff-critical">${eff}%</span>`;
                        if (eff < 10) return `<span class="eff-warning">${eff}%</span>`;
                        if (eff < 60) return `<span class="eff-good">${eff}%</span>`;
                        return `<span class="eff-normal">${eff}%</span>`;
                    } else { // memory
                        if (eff > 80) return `<span class="eff-critical">${eff}%</span>`;
                        if (eff < 30) return `<span class="eff-warning">${eff}%</span>`;
                        if (eff < 70) return `<span class="eff-good">${eff}%</span>`;
                        return `<span class="eff-normal">${eff}%</span>`;
                    }
                };

                row.innerHTML = `
                    <td>${container.namespace}</td>
                    <td>${container.pod}</td>
                    <td>${container.container}</td>
                    <td>${container.resources.cpu.limit}</td>
                    <td>${container.resources.cpu.usage}</td>
                    <td>${formatEfficiency(container.resources.cpu.limit_efficiency_percent, 'cpu')}</td>
                    <td>${container.resources.memory.limit}</td>
                    <td>${container.resources.memory.usage}</td>
                    <td>${formatEfficiency(container.resources.memory.limit_efficiency_percent, 'memory')}</td>
                    <td>${status}</td>
                `;

                row.style.cursor = 'pointer';
                row.title = '–ö–ª–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥ kubectl';
                row.onclick = () => showContainerDetails(container);

                tbody.appendChild(row);
            });

            updateLimitsPagination();
            updateLimitsInfo();
        }

        function updateRequestsPagination() {
            const totalPages = Math.ceil(filteredRequestsData.length / itemsPerPage);
            const pagination = document.getElementById('requests-pagination');

            let html = `
                <button onclick="changeRequestsPage(${currentRequestsPage - 1})"
                        ${currentRequestsPage === 1 ? 'disabled' : ''}>‚Äπ –ù–∞–∑–∞–¥</button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentRequestsPage - 2 && i <= currentRequestsPage + 2)) {
                    html += `<button onclick="changeRequestsPage(${i})"
                             ${i === currentRequestsPage ? 'class="active"' : ''}>${i}</button>`;
                } else if (i === currentRequestsPage - 3 || i === currentRequestsPage + 3) {
                    html += '<span>...</span>';
                }
            }

            html += `
                <button onclick="changeRequestsPage(${currentRequestsPage + 1})"
                        ${currentRequestsPage === totalPages ? 'disabled' : ''}>–í–ø–µ—Ä–µ–¥ ‚Ä∫</button>
            `;

            pagination.innerHTML = html;
        }

        function updateLimitsPagination() {
            const totalPages = Math.ceil(filteredLimitsData.length / itemsPerPage);
            const pagination = document.getElementById('limits-pagination');

            let html = `
                <button onclick="changeLimitsPage(${currentLimitsPage - 1})"
                        ${currentLimitsPage === 1 ? 'disabled' : ''}>‚Äπ –ù–∞–∑–∞–¥</button>
            `;

            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentLimitsPage - 2 && i <= currentLimitsPage + 2)) {
                    html += `<button onclick="changeLimitsPage(${i})"
                             ${i === currentLimitsPage ? 'class="active"' : ''}>${i}</button>`;
                } else if (i === currentLimitsPage - 3 || i === currentLimitsPage + 3) {
                    html += '<span>...</span>';
                }
            }

            html += `
                <button onclick="changeLimitsPage(${currentLimitsPage + 1})"
                        ${currentLimitsPage === totalPages ? 'disabled' : ''}>–í–ø–µ—Ä–µ–¥ ‚Ä∫</button>
            `;

            pagination.innerHTML = html;
        }

        function changeRequestsPage(page) {
            const totalPages = Math.ceil(filteredRequestsData.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentRequestsPage = page;
                displayRequestsTable();
            }
        }

        function changeLimitsPage(page) {
            const totalPages = Math.ceil(filteredLimitsData.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentLimitsPage = page;
                displayLimitsTable();
            }
        }

        function updateRequestsInfo() {
            const total = filteredRequestsData.length;
            const start = (currentRequestsPage - 1) * itemsPerPage + 1;
            const end = Math.min(currentRequestsPage * itemsPerPage, total);
            document.getElementById('requests-info').textContent =
                `–ü–æ–∫–∞–∑–∞–Ω–æ ${start}-${end} –∏–∑ ${total} –∑–∞–ø–∏—Å–µ–π`;
        }

        function updateLimitsInfo() {
            const total = filteredLimitsData.length;
            const start = (currentLimitsPage - 1) * itemsPerPage + 1;
            const end = Math.min(currentLimitsPage * itemsPerPage, total);
            document.getElementById('limits-info').textContent =
                `–ü–æ–∫–∞–∑–∞–Ω–æ ${start}-${end} –∏–∑ ${total} –∑–∞–ø–∏—Å–µ–π`;
        }

        function filterRequestsTable(category) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('#requests-tab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (category === 'all') {
                filteredRequestsData = [...requestsData];
            } else {
                filteredRequestsData = requestsData.filter(container => {
                    const cpuCat = container.analysis.requests.cpu_category;
                    const memCat = container.analysis.requests.memory_category;
                    return cpuCat === category || memCat === category;
                });
            }

            currentRequestsPage = 1;
            displayRequestsTable();
        }

        function filterLimitsTable(category) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('#limits-tab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (category === 'all') {
                filteredLimitsData = [...limitsData];
            } else {
                filteredLimitsData = limitsData.filter(container => {
                    const cpuCat = container.analysis.limits.cpu_category;
                    const memCat = container.analysis.limits.memory_category;
                    return cpuCat === category || memCat === category;
                });
            }

            currentLimitsPage = 1;
            displayLimitsTable();
        }

        function searchRequestsTable(query) {
            const searchTerm = query.toLowerCase();
            if (searchTerm === '') {
                filteredRequestsData = [...requestsData];
            } else {
                filteredRequestsData = requestsData.filter(container =>
                    container.namespace.toLowerCase().includes(searchTerm) ||
                    container.pod.toLowerCase().includes(searchTerm) ||
                    container.container.toLowerCase().includes(searchTerm)
                );
            }
            currentRequestsPage = 1;
            displayRequestsTable();
        }

        function searchLimitsTable(query) {
            const searchTerm = query.toLowerCase();
            if (searchTerm === '') {
                filteredLimitsData = [...limitsData];
            } else {
                filteredLimitsData = limitsData.filter(container =>
                    container.namespace.toLowerCase().includes(searchTerm) ||
                    container.pod.toLowerCase().includes(searchTerm) ||
                    container.container.toLowerCase().includes(searchTerm)
                );
            }
            currentLimitsPage = 1;
            displayLimitsTable();
        }

        function sortRequestsTable(columnIndex) {
            const getValue = (container, index) => {
                switch(index) {
                    case 0: return container.namespace;
                    case 1: return container.pod;
                    case 2: return container.container;
                    case 5: return container.resources.cpu.request_efficiency_percent;
                    case 8: return container.resources.memory.request_efficiency_percent;
                    default: return '';
                }
            };

            filteredRequestsData.sort((a, b) => {
                const aVal = getValue(a, columnIndex);
                const bVal = getValue(b, columnIndex);

                if (typeof aVal === 'number') {
                    return bVal - aVal; // –£–±—ã–≤–∞–Ω–∏–µ –¥–ª—è —á–∏—Å–µ–ª
                } else {
                    return aVal.localeCompare(bVal); // –í–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ –¥–ª—è —Å—Ç—Ä–æ–∫
                }
            });

            displayRequestsTable();
        }

        function sortLimitsTable(columnIndex) {
            const getValue = (container, index) => {
                switch(index) {
                    case 0: return container.namespace;
                    case 1: return container.pod;
                    case 2: return container.container;
                    case 5: return container.resources.cpu.limit_efficiency_percent;
                    case 8: return container.resources.memory.limit_efficiency_percent;
                    default: return '';
                }
            };

            filteredLimitsData.sort((a, b) => {
                const aVal = getValue(a, columnIndex);
                const bVal = getValue(b, columnIndex);

                if (typeof aVal === 'number') {
                    return bVal - aVal; // –£–±—ã–≤–∞–Ω–∏–µ –¥–ª—è —á–∏—Å–µ–ª
                } else {
                    return aVal.localeCompare(bVal); // –í–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ –¥–ª—è —Å—Ç—Ä–æ–∫
                }
            });

            displayLimitsTable();
        }

        function showContainerDetails(container) {
            const details = `–î–µ—Ç–∞–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
Namespace: ${container.namespace}
Pod: ${container.pod}
Container: ${container.container}

–†–µ—Å—É—Ä—Å—ã (Requests):
CPU: ${container.resources.cpu.usage} / ${container.resources.cpu.request} (${container.resources.cpu.request_efficiency_percent}%)
Memory: ${container.resources.memory.usage} / ${container.resources.memory.request} (${container.resources.memory.request_efficiency_percent}%)

–†–µ—Å—É—Ä—Å—ã (Limits):
CPU: ${container.resources.cpu.usage} / ${container.resources.cpu.limit} (${container.resources.cpu.limit_efficiency_percent}%)
Memory: ${container.resources.memory.usage} / ${container.resources.memory.limit} (${container.resources.memory.limit_efficiency_percent}%)

–ö–æ–º–∞–Ω–¥—ã kubectl:
kubectl top pod -n ${container.namespace}
kubectl describe pod -n ${container.namespace} ${container.pod}
kubectl get pod -n ${container.namespace} ${container.pod} -o yaml`;

            alert(details);
        }
    </script>
</body>
</html>
