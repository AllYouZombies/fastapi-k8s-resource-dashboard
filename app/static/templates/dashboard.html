{% extends "base.html" %}

{% block title %}K8s Resource Monitor - Dashboard{% endblock %}

{% block extra_css %}
<style>
.table-container {
    max-height: 500px;
    overflow-y: auto;
}

.status-running { color: #28a745; }
.status-pending { color: #ffc107; }
.status-failed { color: #dc3545; }

.utilization-low { background-color: rgba(40, 167, 69, 0.1); }
.utilization-medium { background-color: rgba(255, 193, 7, 0.1); }
.utilization-high { background-color: rgba(220, 53, 69, 0.1); }

.chart-container {
    position: relative;
    height: 300px;
}

.sortable {
    cursor: pointer;
    user-select: none;
}

.sortable:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.nav-tabs {
    border-bottom: 3px solid #dee2e6;
    margin-bottom: 1rem;
}

.nav-tabs .nav-link {
    border: 2px solid transparent;
    font-weight: 600;
    font-size: 1.1rem;
    padding: 12px 20px;
    margin-right: 0.25rem;
    color: #495057;
    background: linear-gradient(45deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 8px 8px 0 0;
    transition: all 0.3s ease;
}

.nav-tabs .nav-link:hover {
    border-color: #0d6efd;
    color: #0d6efd;
    background: linear-gradient(45deg, #ffffff 0%, #f8f9fa 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.nav-tabs .nav-link.active {
    color: #ffffff;
    background: linear-gradient(45deg, #0d6efd 0%, #0056b3 100%);
    border-color: #0d6efd;
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(13, 110, 253, 0.3);
}

/* Unified filter styling */
.filter-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px solid #dee2e6;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.filter-container .form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
}

.filter-container .form-label i {
    margin-right: 8px;
    color: #0d6efd;
}

.filter-container .form-control,
.filter-container .form-select {
    border: 2px solid #dee2e6;
    border-radius: 8px;
    padding: 10px 15px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #ffffff;
}

.filter-container .form-control:focus,
.filter-container .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    background: #ffffff;
}

.filter-special {
    background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
    border: 2px solid #ffc107;
    border-radius: 12px;
    padding: 15px;
    transition: all 0.3s ease;
}

.filter-special:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
}

.filter-special .form-check-label {
    color: #856404;
    font-weight: 600;
}

.filter-special .form-check-input:checked {
    background-color: #ffc107;
    border-color: #ffc107;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center py-3">
        <h1 class="h2">Kubernetes Resource Monitor</h1>
        <div class="btn-toolbar">
            <button class="btn btn-sm btn-success me-2" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <span id="lastUpdate" class="text-muted small">Last updated: now</span>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5 class="card-title">CPU Requests</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.total_cpu_requests) }}</h3>
                    <small>cores total</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5 class="card-title">CPU Limits</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.total_cpu_limits) }}</h3>
                    <small>cores total</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5 class="card-title">Memory Requests</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.total_memory_requests_gb) }}</h3>
                    <small>GB total</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5 class="card-title">Memory Limits</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.total_memory_limits_gb) }}</h3>
                    <small>GB total</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Usage and Underutilization Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-dark">
                <div class="card-body">
                    <h5 class="card-title">CPU Usage</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.total_cpu_usage) }}</h3>
                    <small>cores actual</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-secondary">
                <div class="card-body">
                    <h5 class="card-title">Memory Usage</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.total_memory_usage_gb) }}</h3>
                    <small>GB actual</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-body">
                    <h5 class="card-title">CPU Underutilization</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.cpu_requests_underutilization) }}</h3>
                    <small>cores wasted (requests)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-body">
                    <h5 class="card-title">Memory Underutilization</h5>
                    <h3 class="card-text">{{ "%.1f"|format(summary_stats.memory_requests_underutilization_gb) }}</h3>
                    <small>GB wasted (requests)</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">CPU vs Requests (%)</div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="cpuRequestsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">CPU vs Limits (%)</div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="cpuLimitsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Memory vs Requests (%)</div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="memoryRequestsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Memory vs Limits (%)</div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="memoryLimitsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filter-container">
        <div class="row">
            <div class="col-md-4">
                <label for="podSearch" class="form-label">
                    <i class="fas fa-search"></i>
                    Search Pod Name:
                </label>
                <input type="text" id="podSearch" class="form-control" placeholder="Enter pod name..." value="{{ search }}">
            </div>
            <div class="col-md-4">
                <label for="namespaceFilter" class="form-label">
                    <i class="fas fa-layer-group"></i>
                    Filter by Namespace:
                </label>
                <select id="namespaceFilter" class="form-select">
                    <option value="all" {% if selected_namespace == "all" %}selected{% endif %}>All Namespaces</option>
                    {% for ns in namespaces %}
                    <option value="{{ ns }}" {% if selected_namespace == ns %}selected{% endif %}>{{ ns }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">
                    <i class="fas fa-filter"></i>
                    Data Completeness:
                </label>
                <div class="filter-special">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="hideIncompleteData" value="true" {% if hide_incomplete %}checked{% endif %}>
                        <label class="form-check-label" for="hideIncompleteData">
                            Hide incomplete records
                        </label>
                        <small class="text-muted d-block">Excludes records missing requests/limits</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs" id="resourceTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="cpu-requests-tab" data-bs-toggle="tab" data-bs-target="#cpu-requests" type="button" role="tab">
                CPU Requests vs Usage
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="cpu-limits-tab" data-bs-toggle="tab" data-bs-target="#cpu-limits" type="button" role="tab">
                CPU Limits vs Usage
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="memory-requests-tab" data-bs-toggle="tab" data-bs-target="#memory-requests" type="button" role="tab">
                Memory Requests vs Usage
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="memory-limits-tab" data-bs-toggle="tab" data-bs-target="#memory-limits" type="button" role="tab">
                Memory Limits vs Usage
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="resourceTabsContent">
        <!-- CPU Requests vs Usage Table -->
        <div class="tab-pane fade show active" id="cpu-requests" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="cpuRequestsTable" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="sortable" data-column="node_name">Node {% if sort_column == 'node_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="namespace">Namespace {% if sort_column == 'namespace' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_name">Pod Name {% if sort_column == 'pod_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="container_name">Container {% if sort_column == 'container_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_phase">Status {% if sort_column == 'pod_phase' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="cpu_request_cores">CPU Requested (m) {% if sort_column == 'cpu_request_cores' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="cpu_usage_cores">CPU Actual (m) {% if sort_column == 'cpu_usage_cores' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="utilization_pct">Utilization % {% if sort_column == 'utilization_pct' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th>Recommendations</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in cpu_requests_data %}
                                <tr>
                                    <td>{{ row.node_name or 'N/A' }}</td>
                                    <td>{{ row.namespace }}</td>
                                    <td>{{ row.pod_name }}</td>
                                    <td>{{ row.container_name }}</td>
                                    <td><span class="status-{{ row.status|lower }}">{{ row.status }}</span></td>
                                    <td>{{ row.requested }}</td>
                                    <td>{{ row.actual }}</td>
                                    <td>{{ row.utilization_pct }}</td>
                                    <td><button class="btn btn-sm btn-outline-primary" onclick="showRecommendations('{{ row.pod_name }}', '{{ row.container_name }}', '{{ row.namespace }}', 'cpu-requests', '{{ row.actual }}', '{{ row.requested }}', '', '', '')"><i class="fas fa-lightbulb"></i></button></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- CPU Limits vs Usage Table -->
        <div class="tab-pane fade" id="cpu-limits" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="cpuLimitsTable" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="sortable" data-column="node_name">Node {% if sort_column == 'node_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="namespace">Namespace {% if sort_column == 'namespace' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_name">Pod Name {% if sort_column == 'pod_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="container_name">Container {% if sort_column == 'container_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_phase">Status {% if sort_column == 'pod_phase' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="cpu_limit_cores">CPU Limit (m) {% if sort_column == 'cpu_limit_cores' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="cpu_usage_cores">CPU Actual (m) {% if sort_column == 'cpu_usage_cores' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="utilization_pct">Utilization % {% if sort_column == 'utilization_pct' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th>Recommendations</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in cpu_limits_data %}
                                <tr>
                                    <td>{{ row.node_name or 'N/A' }}</td>
                                    <td>{{ row.namespace }}</td>
                                    <td>{{ row.pod_name }}</td>
                                    <td>{{ row.container_name }}</td>
                                    <td><span class="status-{{ row.status|lower }}">{{ row.status }}</span></td>
                                    <td>{{ row.limit }}</td>
                                    <td>{{ row.actual }}</td>
                                    <td>{{ row.utilization_pct }}</td>
                                    <td><button class="btn btn-sm btn-outline-primary" onclick="showRecommendations('{{ row.pod_name }}', '{{ row.container_name }}', '{{ row.namespace }}', 'cpu-limits', '{{ row.actual }}', '', '{{ row.limit }}', '', '')"><i class="fas fa-lightbulb"></i></button></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Requests vs Usage Table -->
        <div class="tab-pane fade" id="memory-requests" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="memoryRequestsTable" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="sortable" data-column="node_name">Node {% if sort_column == 'node_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="namespace">Namespace {% if sort_column == 'namespace' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_name">Pod Name {% if sort_column == 'pod_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="container_name">Container {% if sort_column == 'container_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_phase">Status {% if sort_column == 'pod_phase' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="memory_request_bytes">Memory Requested {% if sort_column == 'memory_request_bytes' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="memory_usage_bytes">Memory Actual {% if sort_column == 'memory_usage_bytes' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="utilization_pct">Utilization % {% if sort_column == 'utilization_pct' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th>Recommendations</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in memory_requests_data %}
                                <tr>
                                    <td>{{ row.node_name or 'N/A' }}</td>
                                    <td>{{ row.namespace }}</td>
                                    <td>{{ row.pod_name }}</td>
                                    <td>{{ row.container_name }}</td>
                                    <td><span class="status-{{ row.status|lower }}">{{ row.status }}</span></td>
                                    <td>{{ row.requested }}</td>
                                    <td>{{ row.actual }}</td>
                                    <td>{{ row.utilization_pct }}</td>
                                    <td><button class="btn btn-sm btn-outline-primary" onclick="showRecommendations('{{ row.pod_name }}', '{{ row.container_name }}', '{{ row.namespace }}', 'memory-requests', '', '', '', '{{ row.actual }}', '{{ row.requested }}')"><i class="fas fa-lightbulb"></i></button></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Memory Limits vs Usage Table -->
        <div class="tab-pane fade" id="memory-limits" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="memoryLimitsTable" class="table table-striped table-hover" style="width:100%">
                            <thead>
                                <tr>
                                    <th class="sortable" data-column="node_name">Node {% if sort_column == 'node_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="namespace">Namespace {% if sort_column == 'namespace' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_name">Pod Name {% if sort_column == 'pod_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="container_name">Container {% if sort_column == 'container_name' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="pod_phase">Status {% if sort_column == 'pod_phase' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="memory_limit_bytes">Memory Limit {% if sort_column == 'memory_limit_bytes' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="memory_usage_bytes">Memory Actual {% if sort_column == 'memory_usage_bytes' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th class="sortable" data-column="utilization_pct">Utilization % {% if sort_column == 'utilization_pct' %}{% if sort_direction == 'asc' %}↑{% else %}↓{% endif %}{% endif %}</th>
                                    <th>Recommendations</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in memory_limits_data %}
                                <tr>
                                    <td>{{ row.node_name or 'N/A' }}</td>
                                    <td>{{ row.namespace }}</td>
                                    <td>{{ row.pod_name }}</td>
                                    <td>{{ row.container_name }}</td>
                                    <td><span class="status-{{ row.status|lower }}">{{ row.status }}</span></td>
                                    <td>{{ row.limit }}</td>
                                    <td>{{ row.actual }}</td>
                                    <td>{{ row.utilization_pct }}</td>
                                    <td><button class="btn btn-sm btn-outline-primary" onclick="showRecommendations('{{ row.pod_name }}', '{{ row.container_name }}', '{{ row.namespace }}', 'memory-limits', '', '', '', '{{ row.actual }}', '', '{{ row.limit }}')"><i class="fas fa-lightbulb"></i></button></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <nav aria-label="Resource pagination" class="mt-3">
        <ul class="pagination justify-content-center">
            {% if current_page > 1 %}
            <li class="page-item">
                <a class="page-link" href="/dashboard?page={{ current_page - 1 }}{% if search %}&search={{ search }}{% endif %}{% if selected_namespace != 'all' %}&namespace={{ selected_namespace }}{% endif %}{% if sort_column %}&sort_column={{ sort_column }}&sort_direction={{ sort_direction }}{% endif %}">Previous</a>
            </li>
            {% endif %}
            
            {% for page_num in range(1, total_pages + 1) %}
                {% if page_num == current_page %}
                <li class="page-item active">
                    <span class="page-link">{{ page_num }}</span>
                </li>
                {% elif page_num <= 5 or page_num > total_pages - 5 or (page_num >= current_page - 2 and page_num <= current_page + 2) %}
                <li class="page-item">
                    <a class="page-link" href="/dashboard?page={{ page_num }}{% if search %}&search={{ search }}{% endif %}{% if selected_namespace != 'all' %}&namespace={{ selected_namespace }}{% endif %}{% if sort_column %}&sort_column={{ sort_column }}&sort_direction={{ sort_direction }}{% endif %}">{{ page_num }}</a>
                </li>
                {% endif %}
            {% endfor %}
            
            {% if current_page < total_pages %}
            <li class="page-item">
                <a class="page-link" href="/dashboard?page={{ current_page + 1 }}{% if search %}&search={{ search }}{% endif %}{% if selected_namespace != 'all' %}&namespace={{ selected_namespace }}{% endif %}{% if sort_column %}&sort_column={{ sort_column }}&sort_direction={{ sort_direction }}{% endif %}">Next</a>
            </li>
            {% endif %}
        </ul>
    </nav>

    <!-- Recommendations Modal -->
    <div class="modal fade" id="recommendationsModal" tabindex="-1" aria-labelledby="recommendationsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="recommendationsModalLabel">
                        <i class="fas fa-lightbulb text-warning"></i>
                        Resource Recommendations
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Pod:</strong> <span id="modal-pod-name"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Container:</strong> <span id="modal-container-name"></span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Namespace:</strong> <span id="modal-namespace"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Type:</strong> <span id="modal-type"></span>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="fas fa-chart-line"></i> Current Usage</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <strong>CPU:</strong> <span id="current-cpu" class="text-primary"></span>
                                    </div>
                                    <div>
                                        <strong>Memory:</strong> <span id="current-memory" class="text-primary"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="fas fa-thumbs-up"></i> Recommended Resources</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <strong>CPU Request:</strong> <span id="recommended-cpu-request" class="text-success"></span>
                                    </div>
                                    <div class="mb-2">
                                        <strong>CPU Limit:</strong> <span id="recommended-cpu-limit" class="text-success"></span>
                                    </div>
                                    <div class="mb-2">
                                        <strong>Memory Request:</strong> <span id="recommended-memory-request" class="text-success"></span>
                                    </div>
                                    <div>
                                        <strong>Memory Limit:</strong> <span id="recommended-memory-limit" class="text-success"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle"></i>
                        <strong>Rationale:</strong>
                        <ul class="mb-0 mt-2">
                            <li>CPU recommendations are rounded to 50m increments (up to 1000m) or 100m increments (above 1000m)</li>
                            <li>Memory recommendations are rounded to 64Mi/128Mi/0.1Gi based on usage patterns</li>
                            <li>Limits are set to ensure actual usage stays within 80% of the limit</li>
                        </ul>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-code"></i> YAML Configuration</h6>
                        </div>
                        <div class="card-body">
                            <pre id="yaml-config" class="bg-light p-3" style="border-radius: 5px; font-size: 0.9rem;"></pre>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="copyYamlToClipboard()">
                        <i class="fas fa-copy"></i> Copy YAML
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='js/dashboard.js') }}"></script>
<script>
$(document).ready(function() {
    initializeTables();
    initializeCharts();
    startAutoRefresh();
    addPaginationHandlers(); // Add pagination handlers on page load
});
</script>
{% endblock %}